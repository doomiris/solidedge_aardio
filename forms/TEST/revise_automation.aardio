import win.ui;
/*DSG{{*/
var winform = win.form(text="aardio form";right=759;bottom=469)
winform.add(
button={cls="button";text="Button";left=19;top=21;right=195;bottom=70;z=2};
edit={cls="edit";left=16;top=92;right=741;bottom=445;edge=1;multiline=1;z=1}
)
/*}}*/

import key.hotkey;
var superHotkey = key.hotkey();


import winex;
import key.ime;
import win.dlg.message;
var revise = function(hwnd,str){
	import win;
	import FlaUI.UIA3;
	//查找窗口，禁用模式匹配语法搜索窗口（首字符为 `@`）
	var window = FlaUI.FindWindow("Teamcenter");
	if !window {
		winform.edit.print("未找到窗口");
		return;
	}
	if !string.startsWith(window.Name,"Teamcenter RAC",true){
		winform.edit.print("未找到窗口 Teamcenter RAC");
		return;
	}	
	//前置窗口
	window.Focus();
	
	 hwnd := win.getForeground();
	 key.ime.setOpenStatus(0,hwnd);
	//查找控件
	var ctrl  = window.FindFirstByXPath(`//Text[@Name="修订..."]`);
	
	//移动鼠标到 UIA 节点内的相对坐标
	mouse.move(24,6,ctrl);
	
	//单击鼠标
	mouse.click(24,6,ctrl);
	winex.wait("修订 ::版本");
	sleep(1000)
	var m_window = FlaUI.FindWindow("javaw.exe",,"修订 ::版本 ");

	var ectrls  = m_window.FindAllByXPath(`//Edit[@ClassName="Edit"]`);	
	var ectrl = FlaUI.AsTextBox(ectrls[2]);

	
	ectrl.Enter(str);
	sleep(150)
	//查找控件
	var fctrl  = m_window.FindFirstByXPath(`//Button[@Name="完成(F)"]`);

	//移动鼠标到 UIA 节点内的相对坐标
	mouse.move(43,13,fctrl);
	
	//单击鼠标
	mouse.click(43,13,fctrl);	
	winex.waitClose("修订 ::版本");

	window.Focus()
	sleep(500)
	key.press(0x28/*_VK_DOWN*/);

}


superHotkey.loadTable({
	["CTRL+ALT+R"] = revise;
})

var txts = {"MonaxEco-SE 125 蒸发器焊接组装", "MonaxEco-SE 188 蒸发器焊接组装", "MonaxEco-SE 250 蒸发器焊接组装", "MonaxEco-SE 375 蒸发器焊接组装", "MonaxEco-SE 125 蒸发器可选项", "MonaxEco-SE 188 蒸发器可选项", "MonaxEco-SE 250 蒸发器可选项", "MonaxEco-SE 375 蒸发器可选项"};


import console;
console.open();


winform.button.oncommand = function(id,event){
	for (i=1;#txts){
		winform.edit.print(i, txts[i]);
		revise(,txts[i]);
		sleep(500)
	}
}

winform.show();
win.loopMessage();
return winform;