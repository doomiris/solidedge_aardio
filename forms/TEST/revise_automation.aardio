import win.ui;
/*DSG{{*/
var winform = win.form(text="aardio form";right=759;bottom=469)
winform.add(
button={cls="button";text="Button";left=19;top=21;right=195;bottom=70;z=2};
edit={cls="edit";left=16;top=92;right=741;bottom=445;edge=1;multiline=1;z=1}
)
/*}}*/

import key.hotkey;
var superHotkey = key.hotkey();


import winex;
import key.ime;

var revise = function(hwnd,str){
	import win;
	import FlaUI.UIA3;
	//查找窗口，禁用模式匹配语法搜索窗口（首字符为 `@`）
	var window = FlaUI.FindWindow("javaw.exe","@SWT_Window0","@我的 Teamcenter - Teamcenter 13");
	if(!window) error("未找到窗口");
		
	//前置窗口
	window.Focus();
	
	 hwnd := win.getForeground();
	 key.ime.setOpenStatus(0,hwnd);
	//查找控件
	var ctrl  = window.FindFirstByXPath(`//Text[@Name="修订..."]`);
	
	//移动鼠标到 UIA 节点内的相对坐标
	mouse.move(24,6,ctrl);
	
	//单击鼠标
	mouse.click(24,6,ctrl);
	winex.wait("修订 物料版本");
	sleep(1000)
	var m_window = FlaUI.FindWindow("javaw.exe",,"@修订 物料版本 ");

	var ectrls  = m_window.FindAllByXPath(`//Edit[@ClassName="Edit"]`);	
	var ectrl = FlaUI.AsTextBox(ectrls[2]);
	//移动鼠标到 UIA 节点内的相对坐标
	
	ectrl.Enter(str);
	sleep(100)
	//查找控件
	var fctrl  = m_window.FindFirstByXPath(`//Button[@Name="完成(F)"]`);

	//移动鼠标到 UIA 节点内的相对坐标
	mouse.move(43,13,fctrl);
	
	//单击鼠标
	mouse.click(43,13,fctrl);	
	winex.waitClose("修订 物料版本");

	window.Focus()
	sleep(500)
	key.press(0x28/*_VK_DOWN*/);

}


superHotkey.loadTable({
	["CTRL+ALT+R"] = revise;
})

var txts = {}

import console;
console.open();


winform.button.oncommand = function(id,event){
	for (i=1;#txts){
		winform.edit.print(i, txts[i]);
		revise(,txts[i]);
		sleep(500)
	}
}

winform.show();
win.loopMessage();
return winform;